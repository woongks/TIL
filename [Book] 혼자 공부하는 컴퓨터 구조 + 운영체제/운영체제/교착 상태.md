### 교착 상태란?

프로세스를 실행하기 위해서는 자원이 필요한데, 두 개 이상의 프로세스가 각자 가지고 있는 자원을 무작정 기다린다면 그 어떤 프로세스도 더 이상 진행할 수 없는 교착 상태가 된다.

다음 동작을 위해 필요한 자원을 서로 다른 프로세스들이 기다리고 있다면 교착 상태에 빠질 수 있다.

교착 상태를 해결하기 위해서는

1. 교착 상태가 발생했을 때의 상황을 정확히 표현해보고
2. 교착 상태가 일어나는 근본적인 이유에 대해 알아야 한다.

#### 자원 할당 그래프

교착 상태는 자원 할당 그래프를 통해 단순하게 표현할 수 있다.
자원 할당 그래프는 어떤 프로세스가 어떤 자원을 사용하고 있고, 또 어떤 프로세스가 어떤 자원을 기다리고 있는지를 표현하는 간단한 그래프다.

> 프로세스는 원, 자원의 종류는 사각형으로 표현된다.
> 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표현한다.
> 프로세스가 어떤 자원을 할당받아 사용 중이라면 자원에서 프로세스를 향해 화살표를 표시한다.
> 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표를 표시한다.

교착 상태게 발생한 상황은 자원 할당 그래프가 원의 형태를 띄고 있다.

#### 교착 상태 발생 조건

1. 상호 배제
2. 점유와 대기
3. 비선점
4. 원형 대기

이 조건이 모두 만족될 때 교착 상태가 발생할 가능성이 생긴다.

##### 상호 배제

교착 상태가 발생하는 근본적인 원인은 해당 자원을 한 번에 하나의 프로세스만 이용할 수 있기 때문이다. 한 프로세스가 사용하는 자원을 다를 프로세스가 사용할 수 없을 때를 상호 배제 상황이라고 한다.

##### 점유와 대기

자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태를 점유와 대기라고 한다.

##### 비선점

어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못했기 때문에 교착 상태가 발생했다고 볼 수 있다.

##### 원형 대기

프로세스들이 원의 형태로 자원을 대기하는 것을 원형 대기라고 한다.

#### 교착 상태 해결 방법

운영체제는 교착 상태를 회피할 수도, 예방할 수도, 검출 후 회복할 수도 있다.

운영체제는 애초에 교착 상태가 일어나지 않도록 교착 상태 발생 조건에 부합하지 않게 자원을 분배하여 교착 상태를 예방할 수 있다.

교착 상태가 발생하지 않을 정도로 조금씩 자원을 할당하다가 교착 상태의 위험이 있다면 자원을 할당하지 않는 방식으로 교착 상태를 회피할 수도 있다.

자원을 제약 없이 할당하다가 교착 상태가 검출되면 교착 상태를 회복하는 방법을 취할 수도 있다.

##### 교착 상태 예방

자원의 상호 배제를 없앤다

- 자원의 상호 배제를 없앤다는 말의 의미는 모든 자원을 공유 가능하게 만든다는 말과 같다. 이론적으로는 가능하지만 현실적으로 모든 자원의 상호 배제를 없애기는 어렵기에 다소 무리가 있다.

점유와 대기를 없앤다

- 점유와 대기를 없애면 운영체제는 특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 배분합니다.
  이 방식도 이론적으로는 교착 상태를 해결할 수 있지만, 단점도 있다. 우선 자원의 활용률이 낮아질 우려가 있다. 점유와 대기를 금지하면 한 프로세스에 필요한 자원들을 몰아줘야 한다. 이는 당장 자원이 필요해도 기다릴 수밖에 없는 프로세스와 사용되지 않으면서 오랫동안 할당되는 자원을 다수 양산하기 때문에 자원의 활용률이 낮아진다.

점유와 대기를 금지하면 많은 자원을 사용하는 프로세스가 불리해진다. 자원을 많이 사용하는 프로세스는 자원을 적게 사용하는 프로세스에 비해 동시에 자원을 사용할 타이밍을 확보하기가 어렵기 때문이다. 이는 결국 많은 자원을 필요로 하는 프로세스가 무한정 기다리게 되는 기아 현상을 야기할 우려가 있다.

비선점 조건을 없앤다

- 비선점 조건을 없애면 자원을 이용 중인 프로세스로부터 해당 자원을 빼앗을 수 있다. 이 방식은 선점하여 사용할 수 있는 일부 자원에 대해서는 효과적이다. 하지만 프린터 같이 한 번에 하나의 프로세스만 이용 가능한 프로세스 같은 경우 도중에 자원을 빼앗아 사용하기 힘들다. 따라서 비선점 조건을 없애 모든 자원을 빼앗을 수 있도록 하는 것은 범용성이 떨어지는 방법이다.

원형 대기 조건을 없앤다.

- 원형 대기를 없애는 방법은 간단하다. 모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하면 원형 대기는 발생하지 않는다.
  원형 대기를 없애는 방법은 앞선 세 방식에 비하면 비교적 현실적이고 실용적이지만, 단점은 있다. 모든 컴퓨터 시스템 내에 존재하는 수많은 자원에 번호를 붙이는 일은 그리 간단한 작업이 아니고 어떤 번호를 붙이느냐에 따라 특정 자원의 활용률이 떨어질 수 있기 때문이다.

따라서 이렇게 예방을 하는 방식은 여러 부작용이 따른다.

##### 교착 상태 회피

교착 상태 회피는 교착 상태가 발생하지 않을 정도로만 조심 조심 자원을 할당하는 방식이다. 교착 상태 회피 방식에서는 교착 상태를 한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주한다.

교착 상태 회피는 프로세스들에 배분할 수 있는 자원의 양을 고려하여 교착 상태가 발생하지 않을 정도의 양만큼만 자원을 배분하는 것을 말한다.

교착 상태를 회피하는 방법을 학습하기 위해서는 안정 상태와 불안정 상태, 그리고 안전 순서열이라는 용어를 알아야 한다.

프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태를 안정 상태라고 부른다.
교착 상태가 발생할 수도 있는 상황을 불안전 상태라고 부른다.

안전 순서열(safe sequence)은 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서를 의미한다.

안전 순서열대로 프로세스들에 자원을 배분하여 교착 상태가 발생하지 않는 상태를 안전 상태라고 한다.

반면 안전 순서열이 없으면 불안정 상태다.

##### 교착 상태 검출 후 회북

교착 상태 검출 후 회복은 교착 상태 발생을 인정하고 사후에 조치하는 방식이다.

이 방식에서 운영체제는 프로세스들이 자원을 요구할 때마다 그때그때 모두 할당하며, 교착 상태 발생 여부를 주기적으로 검사한다. 교착 상태가 검출되면 그때 비로소 다음과 같은 방식으로 회복한다.

###### 선점을 통한 회복

교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식이다.
다른 프로세스로부터 자원을 강제로 빼앗고 한 프로세스에 할당한다.

###### 프로세스 강제 종료를 통한 회복

가장 단순하면서 확실한 방식이다. 교착 상태에 놓인 프로세스를 모두 강제 종료하거나 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료할 수도 있다. 전자는 교착 상태를 해결할 수 있는 가장 확실한 방법이지만 많은 프로세스들이 작업 내역을 잃게 될 가능성이 있다. 후자는 내역을 잃는 프로세스는 최대한 줄일 수 있지만 교착 상태가 없어졌는지 여부를 확인하는 과정에서 오버헤드를 야기한다.

(교착 상태를 무시하는 타조 알고리즘도 있다.)
