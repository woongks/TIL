### 파일 시스템

파일 시스템은 파일과 디렉터리를 관리하는 운영체제 내부 프로그램이다.

파일 시스템 덕분에 단지 데이터 덩어리일 뿐인 파일이나 디렉터리를 손쉽게 생성하고 수정하고 삭제할 수 있는 것이다.

운영체제가 없다면 파일과 디렉터리는 사실 보조기억장치에 있는 데이터 덩어리일 뿐이다.

모든 파일에는 이름과 파일을 실행하기 위한 정보, 그리고 파일 관련 부가 정보가 있다.
이를 속성 또는 메타데이터라고 부른다.

파일 속성 중 파일 유형은 운영체제가 인식하는 파일 종류를 나타낸다.

파일 속성 중 파일 유형은 운영체제가 인식하는 파일 종류를 나타낸다.
같은 이름의 파일일지라도 유형이 다르면 실행 양상도 달라지기 때문에 파일을 실행할 운영체제에 파일 유형을 알려주어야 한다. 가장 흔히 사용하는 방식은 확장자를 이용하는 것이다.

#### 파일 연산을 위한 시스템 호출

파일을 다루는 모든 작업은 운영체제에 의해 이뤄진다. 어떤 응용 프로그램도 임의로 파일을 조작할 수 없으며 파일을 다루려면 운영체제에 부탁해야 한다.
이를 위해 운영체제는 다음과 같은 파일 연산을 위한 시스템 호출을 제공한다.

1. 파일 생성
2. 파일 삭제
3. 파일 열기
4. 파일 닫기
5. 파일 읽기
6. 파일 쓰기

옛날 운영체제에서는 하나의 디렉터리만 존재했다. 모든 파일이 하나의 디렉터리 아래에 있었다. 이와 같은 디렉터리 구조를 1단계 디렉터리라고 부른다. 현재는 여러 계층을 가진 트리 구조 디렉터리가 생겨나게 되었다. 이때 최상위 디렉터리를 루트 디렉터리라고 한다.

절대 경로는 루트 디렉터리부터 시작하는 경로고 상대 경로는 현재 디렉터리부터 시작하는 경로다.

#### 디렉터리 엔트리

디렉터리는 보조기억장치에 테이블 형태의 정보로 저장된다.
각각의 엔트리(행)에 담기는 정보는 파일 시스템마다 차이가 있다.
공통적으로 담기는 정보는 디렉터리에 포함된 대상의 이름과 그 대상이 보조기억장치 내에 저장된 위치를 유추할 수 있는 정보가 담긴다는 점이다.

#### 파티셔닝과 포매팅

파티셔닝은 저장 장치의 논리적인 영역을 구획하는 작업을 의미한다. 칸막이로 영역을 나누는 것과 같다. 나누어진 하나의 영역을 파티션이라고 한다.

포매팅은 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지를 결정하고, 새로운 데이터를 쓸 준비를 하는 작업을 의미한다.

포매팅의 종류에는 저수준 포매팅과 논리적 포매팅이 있다. 전자는 저장 장치를 생성할 당시 공장에서 수행되는 물리적인 포매팅이고 후자는 파일 시스템을 생성하는 포매팅이다.

파티션마다 파일 시스템을 설정할 수 있다.

#### 파일 할당 방법

운영체제는 파일과 디렉터리를 블록 단위로 읽고 쓴다. 하나의 파일이 보조기억장치에 저장될 때는 하나 이상의 블록에 걸쳐 저장된다. 하드 디스크의 가장 작은 저장 단위는 섹터이지만, 운영체제는 하나 이상의 섹터를 블록이라는 단위로 묶은 뒤 블록 단위로 파일과 디렉터리를 관리한다. 파일 시스템이 모든 섹터를 관리하기에는 개수가 너무 많고 크기도 작기 때문이다.

하드 디스크 내에는 여러 블록이 있고 블록에 파일들이 저장된다. 큰 파일은 여러 블록에 걸쳐 저장된다.

파일을 보조기억장치에 할당하는 방법에는 두 가지가 있다. 연속 할당과 불연속 할당이 있다. 불연속 할당에는 연결 할당과 색인 할당이 있다.

##### 연속 할당

말 그대로 연속적인 블록에 파일을 할당하는 방식이다.
이런 파일에 접근 하려면 시작 블록과 블록 단위의 길이만 알면 된다.
구현이 단순하지만 외부 단편화를 야기한다.

##### 연결 할당

연결 리스트처럼 다음 블록을 가리키는 형태로 저장된다.
연결 할당은 외부 단편화 문제를 해결하지만 반드시 첫 번째 블록부터 하나씩 차례대로 읽어야 한다는 단점이 있다. 즉 임의 접근 속도가 느리다.
하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록은 접근할 수 없다는 단점도 있다.
따라서 오늘날에는 위 내용을 그대로 구현하기보다는 이를 조금 변형하여 사용한다.
연결 할당을 변형한 대표적인 파일 시스템이 오늘날까지도 많이 사용하는 FAT 파일 시스템이다.

##### 색인 할당

색인 할당은 파일의 모든 블록 주소를 색인 블록이라는 하나의 블록에 모아 관리하는 방식이다. 특정 파일의 색인 블록을 정하고 그 블록안에 실제 데이터가 있는 블록들의 인덱스를 담는 것이다. 색인 할당은 임의의 위치에 접근하기 쉽다. 색인 할당을 기반으로 만든 파일 시스템이 유닉스 파일 시스템이다.

##### FAT 파일 시스템

FAT(File Allocation Table)이라는 파일 할당 테이블로 구현된 파일 시스템을 말한다.
각 블록에 포함된 다음 블록의 주소들은 모아서 테이블 형태로 관리하는 것이다.
FAT 뒤에 오는 숫자는 블록을 표현하는 비트 수를 의미한다. 윈도우에서는 블록이라는 표현 대신 클러스터라는 용어를 쓴다.

FAT 파일 시스템에서 FAT는 파티션의 앞부분에 만들어진다. FAT는 하드 디스크 파티션의 시작 부분에 있지만 실행하는 도중 메모리에 캐시될 수 있다.

##### 유닉스 파일 시스템

색인 할당은 색인 블록을 기반으로 파일의 데이터 블록들을 찾는 방식이다. 유닉스 파일 시스템에서는 이 색인 블록을 i-node라고 부른다.
하지만 i-node의 크기는 유한하다. i-node 하나는 기본적으로 열다섯 개의 블록 주소를 저장할 수 있기 때문에 i-node 하나는 열다섯 개의 블록을 차지하는 파일까지 가리킬 수 있다. 하지만 그 이상을 차지하는 경우 i-node 하나만으로 파일의 데이터 블록을 모두 가리킬 수 없다.

이를 해결하기 위해 다음과 같은 방법을 취한다:

1. i-node가 가리킬 수 있는 15개의 블록 주소 중 처음 12개는 파일 데이터가 저장된 블록 주소가 직접적으로 명시된다. 이를 직접 블록이라고 한다. 즉, i-node의 열두 개 주소는 직접 블록 주소를 저장한다.
2. 이로 충분하지 않다면 13번째 주소에 단일 간접 블록 주소를 저장한다. 단일 간접 블록 주소란 파일 데이터가 저장된 블록이 아닌 파일 데이터를 저장한 블록 주소가 저장된 블록을 의미한다.
3. 이걸로도 충분하지 않다면 14번째는 이중 간접 블록 주소를 저장한다.
4. 마지막으로는 삼중 간접 블록 주소를 저장한다.

##### 기타

윈도우에서는 NT 파일 시스템, 리눅스 운영체제에서 사용되는 ext 파일 시스템 등이 있다.

컴퓨터를 사용하는 중 컴퓨터가 강제로 종료되어 버린 상황을 생각해보자. 파일 시스템을 변경하는 도중에 이런 시스템 크래시가 발생하면 파일 시스템이 훼손될 수 있다. 이를 해결하기 위해 저널링 기법을 이용하는 저널링 파일 시스템이 등장했다. 이 기법은 작업 로그를 통해 시스템 크래시가 발생했을 때 빠르게 복구하기 위한 방법이다.

저널링 기법을 사용하는 파일 시스템에서 파일 시스템을 변경하는 작업을 다음과 같은 순서로 수행된다:

1. 작업 직전 파티션의 로그 영역에 수행하는 작업에 대한 로그를 남긴다.
2. 로그를 남긴 후 작업을 수행한다.
3. 작업이 끝났다면 로그를 삭제한다.

만약 작업 도중 시스템 크래시가 발생하면 로그만 검사해도 된다.
현대 파일 시스템은 대부분 이러한 저널링 기능을 지원한다.

##### 마운트

마운트라는 표현은 한 저장 장치의 파일 시스템에서 다른 저장 장치의 파일 시스템에 접근할 수 있도록 파일 시스템을 편입시키는 작업을 의미한다 (이어 붙이는 것).
