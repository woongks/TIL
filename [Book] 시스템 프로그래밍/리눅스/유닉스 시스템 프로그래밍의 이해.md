### 리눅스/유닉스 시스템 프로그래밍

시스템에서 제공하는 시스템 호출과 함수를 사용하여 프로그램을 작성하는 것이다.

리눅스에서 파일은 일반 파일과 특수 파일 그리고 디렉터리로 구분할 수 있다.

리눅스와 유닉스는 운영체제로 주로 사용된다.

리눅스의 안전성이 높아지고 성능도 향상되면서 원조격이라고 할 수 있는 유닉스를 리눅스가 서버 운영체제 시장에서 밀어내고 있다.

리눅스/유닉스에서 동작하는 프로그램을 작성하려면 간단한 프로그램을 제외하고 대부분 시스템 호출을 이용한다. 다른 프로그래머가 개발한 프로그램을 이해하려면 어떤 시스템 호출을 어떻게 사용했는지 알고 있어야 한다.

리눅스 시스템과 유닉스 시스템은 C 언어로 구현되었다.
C 언어를 이용하면 제어문이나 자료형, 배열, 구조체, 포인터 같은 기본 구문으로도 여러 응용 프로그램을 작성할 수 있다.

#### 시스템 호출

리눅스 시스템은 파일 시스템 접근, 사용자 정보, 시스템 정보, 시스템 시간 정보, 네트워킹 등 다양한 서비스를 제공한다. 이러한 서비스를 이용해 프로그램을 구현할 수 있도록 제공되는 프로그래밍 인터페이스를 시스템 호출이라고 한다.

시스템 호출은 프로그래밍 인터페이스이며, 기본 형식은 C 언어의 함수와 같다.

시스템 호출명은 함수명처럼 사용할 이름이 정의되어 있다. 호출의 종류에 따라 인자는 있을 수도 있고 없을 수도 있다. 시스템 호출은 결괏값을 리턴하는 경우도 있지만 대부분은 시스템 호출의 성공이나 실패를 알려주는 정숫값을 리턴한다.

#### 라이브러리 함수

라이브러리는 미리 컴파일된 함수를 묶어서 제공하는 특수한 형태의 파일이다. C 언어는 데이터 입출력, 수학 공식, 문자열 처리 등 응용 프로그램 개발에 필요한 함수를 유형별로 분류해 라이브러리로 제공한다.

함수를 묶어서 라이브러리로 만드는 이유는 자주 사용하는 기능을 독립적으로 구현해둠으로써 프로그램 개발과 디버깅을 쉽게 하고 컴파일을 좀 더 빠르게 할 수 있기 때문이다.

리눅스 시스템에서 라이브러리는 보통 /usr/lib에 위치한다. 대부분 리눅스 시스템에서 /lib는 /usr/lib에 대한 심벌릭 링크다. 라이브러리의 이름은 일반적으로 'lib'로 시작하고 확장자는 .a나 .so다. .a는 정적 라이브러리, .so는 공유 라이브러리다.

정적 라이브러리는 프로그램을 컴파일할 때 같이 적재되어 실행 파일을 구성한다.
실행 파일에 라이브러리 코드가 포함되므로 그만큼 크기가 커진다. 반면에 공유 라이브러리는 실행 파일에 포함되지 않는다. 공유 라이브러리를 이용해 생성한 실행 파일은 실행 시에 해당 라이브러리가 메모리에 적재된다. 이렇게 적재된 라이브러리는 다른 실행 파일에서도 공유할 수 있다. 최근에는 메모리를 효율적으로 사용하기 위해 공유 라이브러리를 많이 사용한다.

#### 시스템 호출 vs 라이브러리 함수

응용 프로그램은 라이브러리 함수나 시스템 호출을 이용해 작성할 수 있다.
시스템 호출은 커널의 해당 모듈을 직접 호출해 작업하고 결과를 리턴한다.
라이브러리 함수는 커널 모듈을 직접 호출하지 않고 함수 내부에서 시스템 호출을 사용한다.

리눅스의 매뉴얼은 항목의 종류에 따라 섹션이 구분되어 있다.
man 명령어를 입력하면 섹션 번호를 확인할 수 있는데, 리눅스 명령어는 1, 시스템 호출은 2, 라이브러리 함수는 3에 속한다.

man 명령어로 검색을 하면 섹션 번호가 가장 낮은 것이 기본으로 출력된다. 같은 명령어에 여러 함수가 있을 수 있기 때문이다.

시스템 호출이 성공적으로 수행되면 0을 리턴한다.
실패하면 -1을 리턴하고 전역 변수 errno에 오류 코드를 저장한다.

### 시스템 도구

시스템에서 프로그래밍할 때 반드시 알아야 할 기본 명령은 시스템 접속, 파일, 디렉터리에 관한 것이다.

리눅스 시스템 접속: telnet, ssh
접속 해제: exit, logout

현재 디렉터리 경로 출력: pwd
디렉터리 내용 출력: ls
디렉터리 이동: cd
파일, 디렉터리 복사: cp
파일명/디렉터리명 변경/이동: mv
디렉터리 생성: mkdir
디렉터리 삭제: rmdir
파일 내용 출력: cat
화면 크기 단위로 파일 내용 출력: more
파일/디렉터리 접근 권한 변경: chmod
패턴 검색: grep
프로세스 정보 출력: ps
프로세스 강제 종료: kill
사용자 계정 변경: su
파일/디렉터리 묶기: tar
파일 위치 검색: whereis, which

### 컴파일 환경

프로그램을 실행하려면 컴파일을 해야 한다. 텍스트로 작성한 프로그램을 시스템이 이해할 수 있는 기계어로 변환하는 과정을 컴파일이라고 한다.

프로그램을 컴파일하려면 이를 수행하는 컴파일러가 설치되어 있어야 한다. 리눅스에는 기본적으로 gcc(GNU C 컴파일러) 설치가 가능하고 유닉스에도 가능하다. gcc는 ANSI C와 호환성이 있다.

#### Makefile과 make

대부분의 경우 프로그램을 작성할 때 소스 파일 여러 개로 구성되고 컴파일할 때 이를 묶어서 하나의 실행 파일을 생성한다. 리눅스 시스템에서는 여러 개의 .c 파일을 컴파일하고 링크해 하나의 실행 파일로 생성하는 데 사용하는 도구로 Makefile과 make 명령을 제공한다.

Makefile은 컴파일 명령, 소스 파일을 컴파일하는 방법, 링크할 파일, 실행 파일명 등을 설정하는 파일이다. make 명령은 Makefile을 읽고 이 파일에서 지정한대로 컴파일을 실행해 실행 파일을 생성한다. 실행 파일을 생성한 후에는 변경사항이 있는 파일만 재컴파일해 실행 파일을 생성한다.

#### 오류 처리 함수

시스템 호출은 오류 발생 시 -1을 리턴하고 전역 변수 errno에 에러 코드가 저장된다.
errno에 저장되는 값은 상수이므로 이 오류가 무엇을 나타내는지 알아보려면 헤더 파일을 열고 해당 상수의 정의를 찾아봐야 한다.
오류 코드를 메시지로 변환해 출력하는 perror(), strerror() 함수를 사용하면 이러한 수고를 덜 수 있다.

#### 동적 메모리 할당

배열은 프로그램이 시작될 때 필요한 메모리를 미리 확보한다. 이와 달리 프로그램 실행 도중에 필요한 메모리 공간을 할당하고 더 이상 사용하지 않으면 해당 공간을 해제하는 것이 동적 메모리 할당이다. 동적 메모리 할당을 황용하면 필요한 데이터의 양에 따라 메모리 공간을 효율적으로 사용할 수 있다. 메모리를 할당하는 함수로는 malloc(), calloc(), reallock() 등이 있고, 사용을 마친 메모리를 해제하는 함수로는 free()가 있다.

#### 명령행 인자

명령행이란 리눅스 시스템에서 사용자가 명령을 입력하는 행을 말한다. 즉, 프롬프트가 나타나고 커서가 사용자 입력을 기다리고 있는 행이다. 명령행 인자 (CLA: Command Line Arguments)란 사용자가 명령행에서 명령을 실행할 때 해당 명령과 함께 지정하는 인자를 말한다.
