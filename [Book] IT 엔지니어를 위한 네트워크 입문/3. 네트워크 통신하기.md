### 유니캐스트, 멀티캐스트, 브로드캐스트, 애니캐스트

네트워크에서 출발지에서 목적지로 데이터를 전송할 때 사용하는 통신 방식이다. 각 통신 방식은 다음과 같다.
1. 유니캐스트
> 출발지와 목적지가 1:1로 통신
2. 브로드캐스트
> 하나의 호스트에서 시작해 동일 네트워크에 존재하는 모든 호스트가 목적지
3. 멀티캐스트
> 하나의 출발지에서 다수의 특정 목적지로 데이터 전송
4. 애니캐스트
> 1:1 통신인데 동일 그룹 내 가장 가까운 호스트에서 응답.

대부분의 통신은 출발지와 목적지가 정해져 있는 유니캐스트 방식이다.

브로드캐스트의 경우 목적지 주소가 모든으로 표기되어 있는 통신 방식이다. 보통 유니캐스트로 통신하기 전 상대방의 정확한 위치를 알기 위해 사용된다.

멀티캐스트는 멀티캐스트 그룹 주소를 이용해 해당 그룹에 속한 다수의 호스트로 패킷을 전송하기 위한 통신 방식이다. IPTV와 같은 실시간 방송을 볼 때 이 멀티캐스트 통신 방식을 사용한다. 사내 방송이나 증권 시세 전송과 같이 단방향으로 다수에게 동시에 같은 내용을 전달해야 할 때 사용된다.

애니캐스트는 특유의 성질을 이용해서 가장 가까운 DNS 서버나 게이트웨이를 찾는 기능에 사용하기도 한다. 

BUM 트래픽
> Broadcast, Unknown Unicast, Multicast를 지칭한다.
언노운 유니캐스트는 유니캐스트여서 목적지 주소는 명확히 명시되어 있지만 네트워크에서의 동작은 브로드캐스트와 같을 때를 가리킨다. 스위치가 목적지에 대한 주소를 학습하지 못한 상황이라 패킷을 모든 포트로 플러딩하는 경우를 말한다. 이처럼 다수에 보내는 기능은 네트워크 입장에서 자원을 쓸데없이 사용하는 것이기 때문에 불필요한 BUM 트래픽이 많아지면 네트워크 성능이 저하될 수 있다.
(이더넷 환경에서는 ARP 브로드캐스트를 먼저 보내고 이후 통신을 시작하므로 BUM 트래픽이 많이 발생하지 않는다.)

### MAC 주소

Media Access Control의 줄임말로 2계층에서 통신을 위해 네트워크 인터페이스에 할당된 고유 식별자이다. 네트워크에 접속하는 모든 장비는 MAC 주소라는 물리적인 주소가 있어야 하고 이 주소를 이용해 서로 통신한다.

#### MAC 주소 체계

MAC 주소는 하드웨어에 고정되어 출하되므로 네트워크 구성 요소마다 다른 주소를 갖고 있다.
네트워크 장비 제조업체에 주소 풀을 할당하는 것을 제조사 코드라고 부르며 이 주소는 IEEE가 관리한다.

MAC 주소는 48비트이며 앞 24비트는 제조사 코드이며 OUI(Organizational Unique Identifier) 값이라 부른다.

뒤의 24비트인 UAA(Universally Administered Address)는 각 제조사에서 자체적으로 할당한다. 

MAC 주소는 BIA(Burned-In Address)라고도 불린다.
MAC 주소는 BIA 상태로 NIC에 할당되어 있다. 일반적으로 ROM 형태로 고정되어 출하되므로 NIC에 고정된 MAC 주소를 변경하기는 어렵다. 하지만 결국 MAC 주소도 메모리에 적재되어 구동되므로 여러 가지 방법을 이용해 변경된 MAC 주소로 NIC을 동작시킬 수 있다.

#### MAC 주소 동작

NIC은 자신의 MAC 주소를 가지고 있고 전기 신호가 들어오면 2계층에서 데이터 형태로 변환하여 내용을 구분한 후 도착지 MAC 주소를 확인한다. 해당 주소가 자신의 주소와 다르면 그 패킷을 폐기한다. 그게 아니면 처리해야 할 주소로 인지해 패킷 정보를 상위 계층으로 넘겨준다.

패킷이 정상적으로 NIC를 통과하면 OS나 애플리케이션 레벨에서 처리되기 때문에 시스템에 부하가 작용한다.

무차별 모드(promiscuous mode)

네트워크 상태를 모니터링하거나 디버그, 분석 용도로 네트워크 전체 패킷을 수집해 분석해야 할 경우, NIC이 정상적으로 동작하면 다른 목적지를 가진 패킷을 폐기하기 때문에 분석할 수 없다. 이런 경우, 무차별 모드로 NIC을 구성한다. 무차별 모드는 자신의 MAC 주소와 상관없는 패킷이 들어와도 이를 분석할 수 있도록 메모리에 올려 처리할 수 있게 한다. 대표적인 애플리케이션은 와이어샤크가 있다.

### IP 주소

OSI 7계층에서 주소를 갖는 계층은 2계층과 3계층이다. 2계층은 물리 주소인 MAC 주소를 사용하고 3계층은 논리 주소인 IP 주소를 사용한다.

흔히 사용하는 IP 주소는 32비트인 IPv4 주소다. IP 주소는 네트워크와 호스트 주소로 나뉜다. 네트워크 주소가 동일한 네트워크를 로컬 네트워크라고 한다. 호스트 주소는 동일 네트워크 내에 존재하는 호스트를 구분하기 위함이다.

MAC 주소는 24비트씩 절반으로 구분되지만, IP 주소는 고정되어 있지 않다. IP 주소 체계는 필요한 호스트 IP 개수에 따라 네트워크 크기를 다르게 할당할 수 있는 클래스 개념을 도입했다. A 클래스는 1600만 개, B 클래스는 6만 5천 개, C 클래스는 약 250 개의 IP 주소를 가질 수 있다. A 클래스는 첫 번째 옥텟에, B는 두 번째, C는 세 번째 옥텟에 구분자가 있고 이 구분자를 서브넷 마스크라고 한다.
클래스 개념은 다른 고정된 네트워크 주소 체계에 비해 주소를 절약할 수 있다는 장점이 있다.

#### 클래스풀과 클래스리스

IP 주소 체계에서 설명한 클래스 기반의 IP 주소 체계를 클래스풀(Classful)이라고 부른다. IP 주소 체계를 처음 만들었을 때는 클래스 개념을 도입한 것이 확장성이 있고 주소 낭비가 적은 최적의 조건을 만들 수 있었던 좋은 선택이었다. 이 주소 체계에서는 네트워크 주소와 호스트 주소를 구분짓는 구분자(서브넷 마스크)가 필요없다.

인터넷이 상용화되면서 연결되는 호스트 숫자가 폭발적으로 증가했다. 기존 클래스풀 기반의 주소 체계는 확장성과 효율성을 모두 잡는 좋은 주소 체계였지만 기하급수적으로 늘어나는 IP 주소 요구를 감당하기에는 너무 부족했다. IP 주소 부족과 낭비 문제를 해결하기 위해 3가지 보존, 전환전략을 만들어냈는데 그 중 첫 번째 단기 대책은 클래스리스, CIDR(Classless Inter-Domain Routing) 기반의 주소 체계였다. 두 번째 중기 대책은 NAT와 사설 IP 주소, 세 번째 장기 대책은 차세대 IP인 IPv6이다.

IPv4의 가장 큰 문제는 주소 자체의 부족도 있지만 상위 클래스(A Class)를 할당받은 조직에서 이 주소들을 제대로 사용하지 못하면서 낭비하는 것이었다. 이 문제를 해결하기 위해 클래스 개념 자체를 버리는데, 이를 클래스리스라고 부른다. 현재 사용하는 주소 체계는 클래스 개념을 적용하지 않는 클래스리스 기반 주소 체계다. 클래스리스 네트워크에서는 별도로 네트워크와 호스트 주소를 나누는 구분자를 사용해야 하는데 이 구분자를 서브넷 마스크라고 부른다.

서브넷 마스크는 IP 주소와 네트워크 주소를 구분할 때 사용한다. 숫자 1을 네트워크 주소, 0은 호스트 주소로 표시한다. 보통 10진수를 사용해 255.0.0.0, 255.255.255.0과 같이 표현한다. 

만약 103.9.32.146 주소에 255.255.255.0 서브넷 마스크를 사용하는 IP는 네트워크 주소가 103.9.32.0이고 호스트 주소는 0.0.0.146이 된다. 

서브넷 마스크 표현 방법은 비트 단위로 표현하는 방법도 존재한다. /8, /16, /24로 표기한다.

#### 서브네팅

원래 부여된 클래스의 기준을 무시하고 새로운 네트워크-호스트 구분 기준을 사용자가 정해 원래 클래스풀 단위의 네트워크보다 더 쪼개 사용하는 것을 서브네팅이라고 한다. 서브네팅은 현대 클래스리스 네트워크의 가장 큰 특징이다. 옥텟 단위로 구분되는 서브네팅은 이해와 운영이 쉽지만 실제로는 옥텟 단위보다 더 잘게 네트워크를 쪼개 2진수의 1비트 단위로 네트워크를 분할하므로 서브네팅을 이해하기 어렵다.

실무에서 서브네팅에 대해 고민해야 하는 경우는 두 가지다. 네트워크 디자인 단계에서 네트워크 설계자가 네트워크를 효율적으로 어떻게 분할할 것인지 계획하는 경우와 이미 분할된 네트워크에서 사용자가 자신의 네트워크와 원격지 네트워크를 구분해야 하는 경우다. 상황에 따라 고려해야 할 요소와 범위가 달라진다.

- 네트워크 사용자 입장
> 네트워크에서 사용할 수 있는 IP 범위 파악  
기본 게이트웨이와 서브넷 마스크 설정이 제대로 되어 있는지 확인
- 네트워크 설계자 입장
> 네트워크 설계 시 네트워크 내에 필요한 단말을 고려한 네트워크 범위 설계

#### 네트워크 사용자의 서브네팅

네트워크 사용자는 이미 설계되어 있는 네트워크에서 사용할 수 있는 IP 주소 범위를 파악해야 한다. 주어진 네트워크 범위 밖의 IP를 할당하거나 서브넷 마스크를 잘못 입력하면 로컬 네트워크의 특정 범위에 속해있는 단말과 통신에 문제가 생기거나 외부 네트워크 전체에 통신하지 못하는 상황이 발생한다. 기존 클래스 단위처럼 옥텟 단위의 네트워크를 사용할 경우, 모든 수가 10진수 단위로 표현되므로 관리자나 사용자가 이해하기 쉽지만, 대부분의 서브네팅은 비트 단위로 불할되므로 이런 환경에 속해 있을 경우, 어떤 IP 범위가 내가 속한 네트워크이고 어떤 IP 범위가 원격지 네트워크인지 판단하기 어렵다.

#### 네트워크 설계자의 서브네팅

네트워크를 새로 구축하는 경우, 네트워크 사용자와 반대로 설계자는 서브넷 마스크가 지정되어 주어지는 것이 아니라 네트워크의 크기를 고민해 서브넷 마스크를 결정하고 설계에 반영해야 한다. 네트워크 설계자가 IP를 설계할 때 고민해야 할 부분은 다음과 같다.
- 서브넷된 하나의 네트워크에 IP를 몇 개나 할당해야 하는가?
- 서브넷된 네트워크가 몇 개나 필요한가?

네트워크를 설계할 때 가능하면 사설 IP 대역을 사용해 충분한 IP 대역을 사용하는 것이 좋다. 

공인 IP를 사용해 여유 없이 네트워크를 할당하면 크기가 다른 네트워크가 많아진다. 따라서 사설로 최대한 같은 크기의 네트워크를 할당하고 10진수로 표현해도 쉽게 이해할 수 있는 C 클래스 단위인 24비트로 쪼개 할당하는 것이 바람직하다.

#### 공인 IP와 사설 IP

인터넷에 연결하지 않고 개인적으로 네트워크를 구성한다면 공인 IP 주소를 할당받지 않고도 네트워크를 구축할 수 있다.
이때 사용하는 IP 주소를 사설 IP 주소라고 한다. 외부 인터넷과 연결하려면 공인 IP 주소를 할당받거나 사설 IP를 이용하되 NAT 기술을 사용해야 한다. 
### TCP와 UDP

### ARP

### 서브넷과 게이트웨이