### 스위치 장비 동작

스위치는 MAC 주소를 기반으로 동작한다. 스위치를 아무 설정 없이 네트워크에 연결해도 MAC 주소를 기반으로 패킷을 전달하는 기본 동작을 수행할 수 있다.

스위치는 MAC 주소를 인식하고 패킷을 전달하는 기본 동작 외에도 한 대의 장비에서 논리적으로 네트워크를 분리할 수 있는 VLAN 기능과 네트워크의 루프를 방지하는 스패닝 트리 프로토콜과 같은 기능을 기본적으로 가지고 있다.

각 계층에서 헤더와 데이터(페이로드)를 합친 부분을 PDU(Protocol Data Unit)이라고 부른다. 1계층 PDU는 비트, 2계층 PDU는 프레임, 3계층 PDU는 패킷, 4계층은 세그먼트라고 부르고 애플리케이션에 해당하는 3개 계층(세션, 표현, 응용)은 데이터라고 부른다.

스위치가 없던 오래된 이더넷 네트워크에서는 패킷(프레임)을 전송할 때 서로 경합해 그로 인한 네트워크 성능 저하가 컸다. 이런 경쟁을 없애고 패킷을 동시에 여러 장비가 서로 간섭 없이 통신하도록 도와주는 장비가 스위치다. 스위치를 사용하면 여러 단말이 한꺼번에 통신할 수 있어 통신하기 위해 기다리거나 충돌 때문에 대기하는 문제가 해결되고 네트워크 전체의 통신 효율성이 향상된다.

스위치의 핵심 역할은 누가 어느 위치에 있는지 파악하고 실제 통신이 시작되면 자신이 알고 있는 위치로 패킷을 정확히 전송하는 것이다. 이런 동작은 스위치가 2계층 주소를 이해하고 단말의 주소인 MAC 주소와 단말이 위치하는 인터페이스 정보를 매핑한 MAC 주소 테이블을 갖고 있어서 가능하다.

스위치는 전송하려는 패킷의 헤더 안에 있는 2계층 목적지 주소를 확인하고 MAX 주소 테이블에서 해당 주소가 어느 포트에 있는지 확인해 해당 패킷을 그 포트로만 전송한다. 만약 테이블에 없는 도착지 주소를 가진 패킷이 스위치로 들어오면 스위치는 전체 포트로 패킷을 전송한다. 패킷의 도착지 주소가 테이블에 있으면 해당 주소가 매핑된 포트로만 패킷을 전송하고 다른 포트로는 전송하지 않는다. 스위치의 동작 방식은 3 가지로 정리할 수 있다.

1. 플러딩
2. 어드레스 러닝
3. 포워딩/필터링

#### 플러딩

스위치를 부팅하면 네트워크 관련 정보가 아무 것도 없다. 이때 스위치는 통신을 중재하는 역할을 하지 못하고 허브처럼 동작한다. 허브는 패킷이 들어온 포트를 제외하고 모든 포트로 패킷을 전달한다. 스위치가 허브와 같이 모든 포트로 패킷을 흘리는 동작 방식을 플러딩이라고 한다.

이더넷-TCP/IP 네트워크에서는 ARP 브로드캐스트를 미리 주고받은 후 데이터가 전달되므로 실제로 데이터를 보내고 받을 때는 스위치가 패킷을 플러딩하지 않는다. 스위치를 사용하면 필요한 곳에만 패킷을 포워딩하므로 보안에 도움이 된다. 이 원리를 이용해 스위치에 엉뚱한 MAC 주소를 습득시키거나 MAC 테이블을 꽉 차게 해 스위치의 플러딩 동작을 유도할 수 있다. 이 외에도 ARP 포이즈닝 기법을 이용해 모니터링해야 할 IP의 MAC 주소가 공격자 자신인 것처럼 속여 원하는 통신을 받는 방법을 사용하기도 한다.

#### 어드레스 러닝

스위치가 동작을 정상적으로 수행하려면 MAC 주소 테이블을 만들고 유지해야 한다. MAC 주소 테이블은 어느 포트에 어떤 MAC 주소가 연결되었는지에 대한 정보가 저장되어 있는 임시 테이블이다. 이런 테이블을 만들고 유지하는 과정을 어드레스 러닝이라고 한다.

어드레스 러닝은 패킷의 출발지 MAC 주소 정보를 이용한다. 패킷이 특정 포트에 들어오면 스위치에는 해당 패킷의 출발지 MAC 주소와 포트 번호를 MAC 주소 테이블에 기록한다. 1번 포트에서 들어온 패킷의 출발지 MAC주소가 AAAA라면 1번 포트에 AAAA MAC 주소를 가진 장비가 연결되어 있다고 추론할 수 있어 이런 방법으로 주소 정보를 습득한다. 즉, 브로드캐스트나 멀티캐스트에 대한 MAC 주소를 학습할 수 없다.

#### 포워딩/필터링

스위치의 동작은 매우 간단하다. 패킷이 스위치에 들어온 경우, 도착지 MAC 주소를 확인하고 자신이 가진 MAC 테이블과 비교해 맞는 정보가 있으면 매치되는 해당 포트로 패킷을 포워딩한다. 이때 다른 포트로는 해당 패킷을 보내지 않으므로 이 동작을 필터링이라고 한다. 스위치는 이런 포워딩과 필터링을 통해 목적지로만 패킷이 전달되도록 동작한다.

스위치는 일반적인 유니캐스트에 대해서만 포워딩과 필터링 작업을 수행한다. BUM 트래픽이라고 부르는 브로드캐스트와 언노운 유니캐스트, 멀티캐스트에는 조금 다르게 동작한다. 이런 트래픽은 모두 플러딩한다.

이더넷-TCP/IP 네트워크에서는 스위치가 유니캐스트를 플러딩하는 경우는 거의 없다. ARP 브로드캐스트를 먼저 수행하기 때문이다. 이 ARP를 이용한 MAC 주소 습득 과정에서 이미 스위치는 통신하는 출발지와 목적지의 MAC 주소를 습득할 수 있고 실제 유니캐스트 통신이 시작되면 이미 만들어진 MAC 주소 테이블로 패킷은 포워딩, 필터링한다. ARP와 MAC 테이블은 일정 시간 동안 지워지지 않는데 이 시간을 에이징 타임이라고 한다. 일반적으로 MAC 테이블의 에이징 타임이 단말의 ARP 타임보다 길어 이더넷 네트워크를 플러딩없이 효율적으로 운영할 수 있다.

### VLAN

네트워크에는 다양한 가상화 기술이 쓰이고 있는데 스위치에서는 오래 전부터 VLAN이라는 가상화 기술을 사용해왔다. 하나의 물리 스위치에서 여러 개의 네트워크를 나누어 사용할 수 있다. 즉, 물리적 배치와 상관없이 LAN을 논리적으로 분할, 구성하는 기술이다. 과도한 브로드캐스트로 인한 단말들의 성능 저하, 보안 향상을 위한 차단 용도, 서비스 성격에 따른 정책 적용과 같은 이유로 네트워크가 분리될 필요가 있다.

VLAN을 나누면 하나의 장비를 서로 다른 네트워크를 갖도록 논리적으로 분할한 것이므로 유니캐스트뿐만 아니라 브로드캐스트도 VLAN 간에 통신할 수 없다. VLAN 간의 통신이 필요하다면 서로 다른 네트워크 간의 통신이므로 3계층 장비가 필요하다.

VLAN을 사용하면 물리적 구성과 상관없이 네트워크를 분리할 수 있고 다른 층에 있는 단말이 하나의 VLAN을 사용해 동일한 네트워크로 묶을 수 있다. 이렇게 분리된 단말은 3계층 장비를 통해 통신하게 된다.

### STP
